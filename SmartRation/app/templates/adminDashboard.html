{% extends 'base.html' %}
{% load static %}

{% block sidebar_menu %}
    <a href="{% url 'register' %}" class="nav-link">
        <i class="fas fa-user-plus"></i> Register Admin/Staff
    </a>
    <a href="{% url 'list_ration' %}" class="nav-link">
        <i class="fas fa-boxes"></i> Manage Ration
    </a>
    <a href="{% url 'addfamily' %}" class="nav-link">
        <i class="fas fa-users"></i> Add Family
    </a>
    <a href="{% url 'list_product' %}" class="nav-link">
        <i class="fas fa-cubes"></i> Manage Product
    </a>
{% endblock %}

{% block content %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
    /* Your existing styles */
    .dashboard-container {
        padding: 20px;
    }
    .dashboard-grid {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
    }
    .card-1 {
        background: #f4f4f4;
        padding: 20px;
        border-radius: 8px;
        flex: 1 1 200px;
        text-align: center;
    }
    .dashboard-option {
        text-decoration: none;
        font-size: 1.2rem;
        color: #333;
    }
    .insight-cards {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin-top: 30px;
    }
    .insight-card {
        background: #e2e8f0;
        padding: 15px;
        border-radius: 6px;
        flex: 1 1 200px;
        text-align: center;
        position: relative;
    }
    .insight-title {
        font-weight: bold;
        margin-bottom: 8px;
    }
    .insight-value {
        font-size: 1.5rem;
        color: #111;
    }
    .under-development-badge {
        position: absolute;
        top: 8px;
        right: 8px;
        background: #f39c12;
        color: white;
        padding: 2px 6px;
        font-size: 0.75rem;
        border-radius: 3px;
    }
    .chart-container {
        margin-top: 40px;
        text-align: center;
    }
    .chart-container img {
        max-width: 100%;
        height: auto;
        border: 1px solid #ccc;
        border-radius: 8px;
    }
    .spreadsheet-container {
        width: 100%;
        height: 500px;
        border: none;
        margin-top: 50px;
        border-radius: 8px;
    }
</style>

<div class="dashboard-container">
    <h1>Admin Dashboard</h1>

    <!-- Dashboard Cards -->
    <div class="dashboard-grid">
        <div class="card-1">
            <a href="{% url 'register' %}" class="dashboard-option">
                <i class="fas fa-user-plus"></i> Register Admin/Staff
            </a>
        </div>
        <div class="card-1">
            <a href="{% url 'list_ration' %}" class="dashboard-option">
                <i class="fas fa-boxes"></i> Manage Ration
            </a>
        </div>
        <div class="card-1">
            <a href="{% url 'addfamily' %}" class="dashboard-option">
                <i class="fas fa-users"></i> Add Family
            </a>
        </div>
        <div class="card-1">
            <a href="{% url 'list_product' %}" class="dashboard-option">
                <i class="fas fa-cubes"></i> Manage Product
            </a>
        </div>
    </div>

    <!-- Insight Cards -->
    <div class="insight-cards">
        <div class="insight-card">
            <div class="insight-title">Total Families</div>
            <div class="insight-value">{{ total_families }}</div>
            <div class="under-development-badge">Under Development</div>
        </div>
        <div class="insight-card">
            <div class="insight-title">Products Distributed</div>
            <div class="insight-value">{{ distribution_sum }} kg</div>
        </div>
        <div class="insight-card">
            <div class="insight-title">Pending Stock Requests</div>
            <div class="insight-value">{{ pending_stock_requests }}</div>
        </div>
        <div class="insight-card">
            <div class="insight-title">New Registrations</div>
            <div class="insight-value">{{ new_registrations }}</div>
        </div>
        <div class="insight-card">
            <div class="insight-title">Total Products in Inventory</div>
            <div class="insight-value">{{ total_products }}</div>
        </div>
        <div class="insight-card">
            <div class="insight-title">Total Stock Quantity</div>
            <div class="insight-value">{{ total_stock_quantity }} kg</div>
        </div>
        <div class="insight-card">
            <div class="insight-title">Out-of-Stock Products</div>
            <div class="insight-value">{{ out_of_stock_products }}</div>
        </div>
        <div class="insight-card">
            <div class="insight-title">Average Distribution/Product</div>
            <div class="insight-value">{{ average_distribution_per_product }} kg</div>
        </div>
    </div>

    <!-- Python Generated Charts -->
    <div class="chart-container">
        <h2>Total Stock per Product</h2>
        <img src="data:image/png;base64,{{ stock_per_product_chart }}" alt="Total Stock per Product Chart" />
    </div>

    <div class="chart-container">
        <h2>Out-of-Stock Product Breakdown</h2>
        <img src="data:image/png;base64,{{ out_of_stock_chart }}" alt="Out-of-Stock Product Breakdown Chart" />
    </div>

    <div class="chart-container">
        <h2>Distribution vs Pending Stock Requests</h2>
        <img src="data:image/png;base64,{{ distribution_vs_pending_chart }}" alt="Distribution vs Pending Stock Requests Chart" />
    </div>

    <div class="chart-container">
        <h2>New Registrations Over Time</h2>
        <img src="data:image/png;base64,{{ new_registrations_chart }}" alt="New Registrations Over Time Chart" />
    </div>
</div>

<!-- Google Sheet Embed -->
<iframe class="spreadsheet-container"
    src="https://docs.google.com/spreadsheets/d/e/2PACX-1vTi_dZV8pF_GccoQ8MiQdfQcujSdDnXbQP7KG7r_LU2SvBAw4nfZnMYC1PhuBaoHXekpKevM-WAcH1U/pubhtml?gid=1161769748&single=true&widget=true&headers=false">
</iframe>

{% endblock %}
